<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Management</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style/admin.css" />
  </head>

  <body>
    <div id="bg">
      <h1 id="txt-todolist" class="mt-5">USER MANAGEMENT</h1>
      <button
        class="btn btn-primary mb-3"
        data-bs-toggle="collapse"
        href="#collapseExample"
      >
        Create New User
      </button>
      <div id="collapseExample" class="headSection collapse">
        <div class="input-group mb-3">
          <input
            id="emailInpAdmin"
            type="text"
            class="form-control"
            placeholder="Email"
            aria-label="email"
            aria-describedby="basic-addon1"
          />
        </div>
        <div class="section2">
          <div class="input-group mb-3 me-1">
            <input
              id="usernameInpAdmin"
              type="text"
              class="form-control"
              placeholder="Username"
              aria-label="username"
              aria-describedby="basic-addon2"
            />
          </div>
          <div class="input-group mb-3 ms-1">
            <input
              id="passInpAdmin"
              type="text"
              class="form-control"
              placeholder="Password"
              aria-label="password"
              aria-describedby="basic-addon2"
            />
          </div>
        </div>

        <div class="input-group mb-3 ms-1">
          <input
            id="roleInpAdmin"
            type="text"
            class="form-control"
            placeholder="Role"
            aria-label="role"
            aria-describedby="basic-addon2"
          />
        </div>
        <div id="alert">
          <p id="txt-alert">Error msg</p>
        </div>
        <button class="btnCreate btn btn-primary">Add new user</button>
      </div>
      <form action="/search" method="POST">
      <div class="searchSection mt-4">
        <div class="input-group mb-3">
          <span class="input-group-text" id="basic-addon1">@</span>
          <input
            id="searchInp"
            type="text"
            class="form-control"
            placeholder="Search users"
            aria-label="Username"
            aria-describedby="basic-addon1"
            name="key"
          />
        </div>
          <button type="submit" id="searchBtn" class="btn btn-primary search-btn">
            Search
          </button>
        </div>
      </form> 
      <form action="/dashboard" method="GET" >
        <button type="submit" id="showusers" class="btn btn-secondary search-btn">
          Show All Users
        </button>
      </form>            
      <div class="section-table container mt-3">
        <div class="table-responsive">
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Username</th>
                <th scope="col">Email</th>
                <th scope="col">Join Date</th>
                <th scope="col">Role</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% if(!isSearch){ %>
              <% user.forEach((val,index)=> { %>
              <tr>
                <th scope="row"><%= index+1  %></th>
                <td><%= val.username %></td>
                <td><%= val.email %></td>
                <td><%= val.joinDate %></td>
                <td><%= val.role %></td>
                <td>
                  <button
                    onclick="editClick('<%= val._id %>','<%= val.username %>','<%= val.email %>','<%= val.role %>')"
                    class="btn btn-warning btn-sm"
                  >
                    Edit
                  </button>
                  <button
                    onclick="deleteClick('<%= val._id %>')"
                    class="btn btn-danger btn-sm"
                  >
                    Delete
                  </button>
                </td>
              </tr>
              <% }) %>
              <% }else{ %>
                <p class="errMsg" >No user was found</p>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
      <div id="popup">
        <input type="hidden" name="" id="userId-store" />
        <input placeholder="Edit Username..." id="inp-username" type="text" value="" />
        <input placeholder="Edit Role..." id="inp-role" type="text" />
        <input placeholder="Edit Email..." id="inp-email" type="text" />
        <div>
          <button onclick="cancelClick()" id="btn-cancel">Cancel</button>
          <button onclick="updateClick()" id="btn-update">Update</button>
        </div>
      </div>
    </div>

    <script src="js/dashboard.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
